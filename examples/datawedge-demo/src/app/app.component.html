<ion-app>
  <ion-header>
    <ion-toolbar color="primary">
      <ion-title>{{ title }}</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-content class="ion-padding">
    <ion-card>
      <ion-card-header>
        <ion-card-title>Ejemplo de uso</ion-card-title>
        <ion-card-subtitle>Capacitor DataWedge + Angular 16</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <p>
          Invoca los métodos del plugin y visualiza en tiempo real los
          eventos del listener <code>scan</code> que llegan desde DataWedge.
        </p>
        <ion-chip color="success" *ngIf="!isBusy">
          <ion-label>{{ statusMessage }}</ion-label>
        </ion-chip>
        <ion-chip color="warning" *ngIf="isBusy">
          <ion-label>Ejecutando acción: {{ activeAction }}</ion-label>
        </ion-chip>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <ion-card-title>Métodos del plugin</ion-card-title>
        <ion-card-subtitle>Invoca cualquier acción disponible</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-label position="stacked">Nombre de perfil</ion-label>
          <ion-input [(ngModel)]="profileName" placeholder="DataWedgeDemo"></ion-input>
        </ion-item>

        <ion-grid class="ion-margin-top">
          <ion-row>
            <ion-col size="12" size-md="6">
              <ion-button expand="block" color="primary" (click)="initialize()" [disabled]="isBusy">
                Inicializar Plugin
              </ion-button>
            </ion-col>
            <ion-col size="12" size-md="6">
              <ion-button expand="block" color="secondary" (click)="getAvailability()" [disabled]="isBusy">
                Verificar Disponibilidad
              </ion-button>
            </ion-col>
          </ion-row>
        </ion-grid>

        <div *ngIf="initResult" class="ion-margin-top">
          <ion-text color="medium">
            <p><strong>Inicialización:</strong></p>
            <p>Perfil: {{ initResult.profileName }}</p>
            <p>Intent Action: {{ initResult.intentAction }}</p>
          </ion-text>
        </div>

        <div *ngIf="availability" class="ion-margin-top">
          <ion-text color="medium">
            <p><strong>Disponibilidad:</strong></p>
            <p>DataWedge presente: {{ availability.datawedge.present ? 'Sí' : 'No' }}</p>
            <p>DataWedge habilitado: {{ availability.datawedge.enabled === true ? 'Sí' : (availability.datawedge.enabled === false ? 'No' : 'Desconocido') }}</p>
            <p>Scanner presente: {{ availability.scanner.present === true ? 'Sí' : (availability.scanner.present === false ? 'No' : 'Desconocido') }}</p>
            <p *ngIf="availability.scanner.status">Estado del scanner: {{ availability.scanner.status }}</p>
            <div *ngIf="availability.scanner.scanners && availability.scanner.scanners.length > 0">
              <p>Scanners detectados:</p>
              <ul>
                <li *ngFor="let scanner of availability.scanner.scanners">
                  {{ scanner.name || 'Sin nombre' }} - {{ scanner.connected ? 'Conectado' : 'Desconectado' }}
                </li>
              </ul>
            </div>
          </ion-text>
        </div>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <ion-card-title>Eventos de escaneo</ion-card-title>
        <ion-card-subtitle>Salida de DataWedge.addListener('scan', ...)</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list *ngIf="scanEvents.length > 0; else emptyState">
          <ion-item *ngFor="let scan of scanEvents; trackBy: trackByTimestamp">
            <ion-label>
              <h3>{{ scan.data }}</h3>
              <p>Tipo: {{ scan.labelType || 'No provisto' }}</p>
              <p *ngIf="scan.source">Fuente: {{ scan.source }}</p>
              <p class="timestamp">{{ scan.timestamp }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
        <ng-template #emptyState>
          <p class="empty">Aún no se recibieron eventos de escaneo.</p>
        </ng-template>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <ion-card-title>Bitácora</ion-card-title>
        <ion-card-subtitle>Últimas acciones ejecutadas</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item *ngFor="let log of logs">
            <ion-label class="log-entry">{{ log }}</ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
  </ion-content>
</ion-app>
